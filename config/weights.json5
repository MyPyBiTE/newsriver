{ 
  // weights.json5 — server-side scoring knobs for mypybite
  // Version: v0.5 (adds evening sports boost, team keywords, team badges, domain whitelist)
  // TZ for windows/special dates
  timezone: "America/Toronto",

  // -------- Recency & decay (global defaults) --------
  recency: {
    half_life_hours: 6,
    max_age_hours: 72,
    age_penalty_after_24h: -0.6,
    age_penalty_after_36h: -0.4,
    superseded_cluster_penalty: -0.9,
  },

  recency_overrides: {
    categories: {
      "Culture": { half_life_hours: 4, max_age_hours: 48 },
      "Youth":   { half_life_hours: 4, max_age_hours: 48 }
      // (Sports uses global recency; time windows handled below)
    }
  },

  // -------- Reordering stability --------
  reorder: {
    protect_top_n: 8,
    min_reorder_delta: 1.25,
    grace_period_minutes: 3,
    rank_drift_tolerance: 0.5
  },

  // -------- Regional bias (Canada → Province → City) --------
  regional: {
    weights: {
      country_match: 1.2,
      province_match: 0.8,
      city_match: 0.6,
      adjacent_province: 0.3
    },
    max_bonus: 2.4
  },

  // -------- Category nudges --------
  categories: {
    "Public Safety": 0.9,
    "Weather": 0.6,
    "Transit": 0.4,
    "Local": 0.5,
    "Business": 0.2,
    "Energy": 0.2,
    "Real Estate": 0.15,
    "Tech": 0.15,
    "Culture": 0.25,
    "Youth": 0.25,
    "Sports": 0.30,   // new: light baseline for sports
    "General": 0.0
  },

  // -------- Public-safety severity --------
  public_safety: {
    has_fatality_points: 1.0,
    per_death_points: 0.12,
    max_death_points: 2.0,
    per_injured_points: 0.03,
    max_injury_points: 0.6,
    violent_keywords_bonus: 0.2,
    violent_keywords: [
      "shooting","shot","stabbing","stabbed","homicide","murder",
      "manslaughter","fatal crash","deadly crash","collision","mass casualty",
      "kidnapping","amber alert","hostage","gunfire","mass shooting",
      "assault","carjacking","drive-by","bomb threat","arson"
    ]
  },

  // -------- Markets (intraday & overnight) --------
  markets: {
    btc_abs_move_threshold_pct: 7.0,
    btc_points: 1.6,
    index_abs_move_threshold_pct: 1.0,
    index_points: 1.0,
    nikkei_abs_move_threshold_pct: 1.0,
    nikkei_points: 0.7,
    single_stock_abs_move_threshold_pct: 10.0,
    single_stock_points: 1.2,
    time_windows: {
      markets_open: { start: "09:30", end: "16:00", points: 0.6 },
      asia_window:  { start: "01:20", end: "03:30", points: 0.5 }
    },
    special_dates: [
      { key: "boc_rate_decision", points: 1.6, window_hours: 30 },
      { key: "cpi_ca_release",    points: 1.2, window_hours: 24 },
      { key: "jobs_ca_release",   points: 1.1, window_hours: 24 },
      { key: "fed_fomc_decision", points: 1.5, window_hours: 30 },
      { key: "cpi_us_release",    points: 1.2, window_hours: 24 },
      { key: "jobs_us_nonfarm",   points: 1.1, window_hours: 24 },
      { key: "boe_rate_decision", points: 1.0, window_hours: 24 },
      { key: "ecb_rate_decision", points: 1.0, window_hours: 24 },
      { key: "opec_meeting",      points: 0.8, window_hours: 48 }
    ]
  },

  // -------- Entertainment / Human-interest boosts --------
  entertainment: {
    release_keywords: [
      "premiere","trailer","season","finale","episode","cast","casting",
      "box office","album","single","ep","tracklist","tour","concert",
      "festival","red carpet","press junket","teaser","first look","review",
      "renewed","canceled","soundtrack","chart","debut"
    ],
    keyword_points_per_match: 0.35,
    keyword_points_cap: 0.8,
    trade_entity_bonus: 0.3,
    trade_entity_cap: 0.6,
    trade_domains: [
      "variety.com","hollywoodreporter.com","deadline.com","thewrap.com",
      "rollingstone.com","people.com","billboard.com","ew.com","worldofreel.com",
      "showbiz411.com","tmz.com"
    ],
    time_windows: [
      { key: "evening_pop", start: "18:30", end: "00:30", points: 0.5 },
      { key: "weekend_pop", days: ["Fri","Sat","Sun"], start: "11:00", end: "23:00", points: 0.4 },
      { key: "music_release", days: ["Thu","Fri","Sat"], start: "20:00", end: "14:00", points: 0.4 },
      { key: "box_office", days: ["Sun","Mon"], start: "09:00", end: "12:00", points: 0.4 }
    ]
  },

  // -------- Sports (NEW) --------
  sports: {
    // Apply to items categorized as Sports OR matching sports team keywords
    time_windows: [
      // Evening boost for all sports, not just playoffs (ET)
      { key: "evening_sports", start: "18:00", end: "23:30", points: 1.0 }
    ],

    // Score pattern bump: e.g., "Blue Jays 4-2 Astros" or "Leafs 3–1"
    score_regex: "\\b\\d{1,2}[\\-–]\\d{1,2}\\b",
    score_regex_points: 0.5,

    // Injury/transaction context
    context_keywords: [
      { token: "injured",  points: 0.4 },
      { token: "IL",       points: 0.35 },
      { token: "comeback", points: 0.35 }
    ],
    context_cap: 0.8,

    // Team & star keyword weights (case-insensitive contains on title/summary)
    team_keywords: [
      { token: "Blue Jays",           points: 1.5 },
      { token: "Maple Leafs",         points: 1.4 },
      { token: "Leafs",               points: 1.2 },
      { token: "Raptors",             points: 1.0 },
      { token: "Yankees",             points: 0.9 },
      { token: "Red Sox",             points: 0.9 },
      { token: "Dodgers",             points: 0.9 },
      { token: "Hoffman",             points: 0.7 },            // Jays reliever (e.g., Jordan Hoffman) — adjust if needed
      { token: "Bichette",            points: 1.2 },
      { token: "Alejandro Kirk",      points: 1.2 },
      { token: "Vladimir Guerrero",   points: 1.3 },
      { token: "Guerrero Jr",         points: 1.3 },
      { token: "Vladdy",              points: 1.0 },
      { token: "Shohei Ohtani",       points: 1.1 },
      { token: "Ohtani",              points: 1.0 }
    ],
    team_keywords_cap: 2.5
  },

  // -------- Google Trends assist --------
  trends: {
    enabled: true,
    provider: "google_trends",
    geo: "CA",
    top_n: 30,
    fields_to_match: ["title","summary"],
    match_bonus_min: 0.2,
    match_bonus_max: 1.0,
    half_life_hours: 12,
    ttl_hours: 24,
    cap_total_points: 1.2
  },

  // -------- Aggregators / press wires & source handling --------
  sources: {
    aggregator_penalty: -0.6,
    press_wire_penalty: -0.5,
    preferred_domains_bonus: 0.25,

    // NEW: domains that bypass aggregator/wire penalties and demotions
    whitelist_domains: [
      "mlb.com",
      "sportsnet.ca",
      "tsn.ca"
    ]
  },

  // (Optional) Source limits
  source_limits: {
    top_caps: { top8: 1, top20: 2 },
    burst_control: { items: 6, window_minutes: 30, penalty: -0.7 },

    // NEW: after 18:00 ET, slightly relax caps for whitelisted sports domains
    evening_overrides: {
      window: { start: "18:00", end: "23:30" },
      per_domain: {
        "mlb.com":       { top8: 2, top20: 4 },
        "sportsnet.ca":  { top8: 2, top20: 4 },
        "tsn.ca":        { top8: 2, top20: 4 }
      }
    }
  },

  // -------- Dedupe knobs --------
  dedupe: {
    jaccard_threshold: 0.62,
    newer_bias_points: 0.3,
    non_aggregator_bias_points: 0.3
  },

  // -------- Display effects thresholds & badges --------
  effects: {
    lightsaber_min_score: 2.5,
    lightsaber_also_if: {
      body_count_ge: 5,
      btc_abs_move_ge_pct: 8.0,
      single_stock_abs_move_ge_pct: 15.0
    },
    glitch_min_score: 1.8,

    // NEW: server-side flags to let the front-end prepend team emblems
    // (Front-end should check item.effects.team_badge and render the icon.)
    team_badge_rules: [
      { when_title_contains: ["Blue Jays"],   badge: "bluejays" },
      { when_title_contains: ["Maple Leafs","Leafs"], badge: "leafs" }
    ]
  },

  // -------- Developing stories “static pill” --------
  developing: {
    max_manual_slots: 3,
    pin_bonus_points: 2.0,
    unpin_decay_minutes: 180
  }
}
